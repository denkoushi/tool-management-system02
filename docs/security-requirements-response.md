# 情シス要求へのセキュリティ対応状況

情シス担当部署から提示されたチェックリストに対し、「どのようなリスクを想定し」「何をどう設定し」「結果として何が安心になったのか」を、専門外の方にも分かりやすい言葉でまとめました。右端の列には、詳しい手順が書かれているドキュメントの場所を載せています。

## 1. ネットワークセキュリティ（UFW）

| 要求 | 何が起きるリスクか | どのように対策したか | 期待できる安心 | 運用・確認 | 参照 |
| --- | --- | --- | --- | --- | --- |
| `sudo apt install ufw` | 外部からラズパイのポートを総当たりされ、不要サービスが露出してしまう。 | UFW（ファイアウォール）を導入し、`scripts/configure_ufw.sh` で初期設定を自動化。 | 「門番」を立て、許可した通信だけを通す状態になる。 | `sudo ufw status numbered` でルール確認。 | RUNBOOK 3.3 |
| デフォルト拒否 + 必要ポートのみ許可 | 想定していないポートが開いたままだと、不正アクセスやマルウェア通信の入り口になる。 | `ufw default deny` で基本遮断し、`ufw allow 22/tcp` など必要なポートだけ開放。さらに `configure_ufw.sh <CIDR>` で接続元 IP を限定。 | 通信経路を最小限に絞り、想定外の侵入口を塞げる。 | 例：`sudo ./scripts/configure_ufw.sh 192.168.128.111 --no-enable` → 現地で `sudo ufw enable`。 | RUNBOOK 3.3 |
| 特定 IP のみアクセス許可 | 認めていない PC からの SSH/VNC 操作で設定変更や乗っ取りが行われる。 | SSH と VNC それぞれ、管理端末の IP のみ許可。 | 認証情報が漏れても、許可された場所からしか接続できない。 | `sudo ufw status numbered` で `22/tcp` と `5900/tcp` の許可先を確認。 | RUNBOOK 6.4 |

## 2. アクセス制御

| 要求 | リスク | 対策 | 安心 | 運用・確認 | 参照 |
| --- | --- | --- | --- | --- | --- |
| 管理画面/API の認証 | 誰でもブラウザから USB 同期やシャットダウンを実行される危険。 | `API_AUTH_TOKEN` により管理用 API へトークン認証を追加。UI も初回操作時にパスコード入力。監査ログに成功/失敗を残す。 | 無関係な人が画面を触っても重要操作は実行できず、操作履歴も追跡できる。 | `curl -X POST /api/reset` をトークン無し/有りで叩き、401/200 を確認。必要に応じて `API_TOKEN_ENFORCE=0` で一時的に入力を省略できるが、セキュリティ低下に注意。 | RUNBOOK 3.4 |
| SSH 公開鍵認証化 | パスワード総当たりや初期ユーザーで侵入される。 | `/etc/ssh/sshd_config` でパスワード認証を無効化、`AllowUsers tools01` で利用者を限定。 | 鍵を持つ運用者だけが接続でき、パスワード漏えいの心配が減る。 | `sudo sshd -t` で構文確認。別端末から鍵ログインを確認。 | RUNBOOK 3.3 |
| fail2ban 導入 | SSH への辞書攻撃でパスワードを試され続ける。 | `fail2ban` が一定回数失敗した IP を自動的に遮断。 | ログを見るだけで、攻撃者が数分でロックされることが分かり安心できる。 | `sudo fail2ban-client status sshd` で BAN 状況を確認。 | RUNBOOK 3.3 |

## 3. 不要サービスの無効化

| 要求 | リスク | 対策 | 安心 | 運用・確認 | 参照 |
| --- | --- | --- | --- | --- | --- |
| 不要サービス停止 | 無線や VNC がむやみに開いていると、近くからリモート操作される恐れ。 | Bluetooth を停止。VNC は運用で必須だが、UFW でアクセス元を限定し、ログイン時の警告も確認。 | 「必要な機能だけを残し、誰でも入れるドアを閉じた」状態にできる。 | `systemctl status bluetooth` / `systemctl status vncserver-x11-serviced`。 | RUNBOOK 6.4 |
| 不要ポート閉鎖 | 使っていないポートが露出して攻撃に使われる。 | UFW によるデフォルト拒否。許可ポートは 22/tcp と管理端末向け 5900/tcp のみ。 | 通信ログを見れば、想定外の接続が遮断されている事実を確認できる。 | `sudo ufw status numbered`。 | RUNBOOK 3.3 |
| fail2ban（再掲） |（2 章と同じ） |（2 章と同じ） |（2 章と同じ） | `sudo fail2ban-client status sshd`。 | RUNBOOK 3.3 |

## 4. OS とソフトウェア更新

| 要求 | リスク | 対策 | 安心 | 運用・確認 | 参照 |
| --- | --- | --- | --- | --- | --- |
| オンライン更新 | 脆弱性が放置されると既知の攻撃に晒される。 | 一時的にネット接続できる場合は `sudo apt update && sudo apt upgrade` で最新化。 | 外部に出すタイミングでまとめて更新できる。 | 更新前後に `./scripts/backup_db.sh` で念のためバックアップ。 | RUNBOOK 4.1 |
| オフライン更新 | ネットに出せない環境だと更新できず、脆弱性が残る。 | 社内 PC で `apt-get download` → USB で持ち込み `sudo dpkg -i`。 | 外部に出さなくてもセキュリティパッチを適用できる。 | ダウンロード履歴を記録しておく。 | RUNBOOK 4.1 |
| バックアップ体制 | データ破損時に復旧できない。 | `backup_db.timer` で日次バックアップ、自動保存（14 日保持）。`check_backup_status.sh` で週次点検。 | 「いつでも前日の状態に戻せる」という安心が得られる。 | `./scripts/check_backup_status.sh` の結果を運用ノートへ記録。 | RUNBOOK 4.1-4.3 |

## 5. ClamAV

| 要求 | リスク | 対策 | 安心 | 運用・確認 | 参照 |
| --- | --- | --- | --- | --- | --- |
| ClamAV インストール | USB に潜むマルウェアがそのまま同期され、他拠点にも広がる。 | `sudo apt install clamav` 済み。同期スクリプト内で `clamscan` を自動実行し、検知時は処理を中断。 | USB に不正ファイルが混じっていても、Pi 側で止めて記録できる。 | `/var/log/toolmgmt/usbsync.log` に WARN が残る。 | RUNBOOK 3.1 |
| 手動スキャン例 |（上記同様） | `sudo clamscan -r /path/to/directory` を実行すると安全性を再確認できる。 | 定義更新はオフライン手順で配布するため、ネット遮断でも最新が維持できる。 | RUNBOOK 3.2 |

## 6. 物理的セキュリティ

| 要求 | リスク | 対策 | 安心 | 運用・確認 | 参照 |
| --- | --- | --- | --- | --- | --- |
| ラズパイ筐体の施錠 | 端末を持ち出されたり、USB を直接挿し込まれる。 | 専用ケースに格納し、鍵で管理する運用を推奨。 | 実機アクセスを最小限に抑え、物理的な改ざんリスクを減らせる。 | 定期棚卸しでケース破損・鍵管理状況をチェック。 | security-overview 3 |

---

## 補足

- 上記以外の詳細な手順・運用フローは RUNBOOK と security-overview に統合してあります。
- 追加要望があれば、関連スクリプト (`scripts/`) と連動させる形で随時拡張可能です。
